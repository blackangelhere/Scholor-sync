<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriConnect Digital Twin</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f9fafb;
            height: 100vh;
            display: flex;
            flex-direction: column;
             background-image: url('bg.jpg');
            background-repeat: no-repeat;
            background-size: cover;
        }
        
        .header {
            background-color: #15803d;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .status {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .pulse {
            background-color: #16a34a;
            padding: 0.25rem;
            border-radius: 50%;
            height: 1.5rem;
            width: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pulse-dot {
            background-color: #bbf7d0;
            height: 1rem;
            width: 1rem;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .nav {
            background-color: #166534;
            color: white;
            padding: 0.5rem;
        }
        
        .nav-buttons {
            display: flex;
            gap: 0.25rem;
        }
        
        .nav-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            color: white;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .nav-btn:hover {
            background-color: #15803d;
        }
        
        .nav-btn.active {
            background-color: #16a34a;
        }
        
        .main {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .grid {
            display: grid;
            gap: 1rem;
        }
        
        .grid-cols-1 {
            grid-template-columns: 1fr;
        }
        
        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        @media (min-width: 768px) {
            .md-grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            .md-grid-cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .card {
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .card h2 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .recommendation-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid;
        }
        
        .green-bg {
            background-color: #f0fdf4;
            border-color: #bbf7d0;
            color: #15803d;
        }
        
        .blue-bg {
            background-color: #eff6ff;
            border-color: #93c5fd;
            color: #1d4ed8;
        }
        
        .purple-bg {
            background-color: #faf5ff;
            border-color: #c4b5fd;
            color: #7c3aed;
        }
        
        .crop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .crop-info h4 {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .crop-location {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .progress-bar {
            background-color: #e5e7eb;
            width: 8rem;
            height: 0.5rem;
            border-radius: 0.25rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 0.25rem;
        }
        
        .progress-text {
            font-size: 0.75rem;
            text-align: right;
            margin-top: 0.25rem;
        }
        
        .weather-container {
            display: flex;
            justify-content: space-between;
        }
        
        .weather-day {
            text-align: center;
        }
        
        .weather-icon {
            height: 2rem;
            width: 2rem;
            border-radius: 50%;
            margin: 0.25rem auto;
        }
        
        .chart-container {
            height: 16rem;
            position: relative;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background-color: #f3f4f6;
            padding: 0.5rem;
            text-align: left;
            font-weight: 600;
        }
        
        .table td {
            padding: 0.5rem;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 24rem;
            color: #6b7280;
        }
        
        .placeholder-icon {
            width: 3rem;
            height: 3rem;
            margin-bottom: 1rem;
        }
        
        .impact-item {
            border-left: 4px solid;
            padding-left: 0.75rem;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
            margin-bottom: 1rem;
        }
        
        .impact-yellow {
            border-color: #eab308;
        }
        
        .impact-green {
            border-color: #22c55e;
        }
        
        .impact-blue {
            border-color: #3b82f6;
        }
        
        .impact-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .impact-text {
            font-size: 0.875rem;
            color: #4b5563;
        }
        
        .footer {
            background-color: #166534;
            color: white;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.875rem;
        }
        
        .hidden {
            display: none;
        }
        .aura-container {
            position: absolute;
            top: 200px;
            left: 20px;
            width: 300px;
            background-color: rgba(30, 30, 30, 0.9);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5), 0 0 0 2px rgba(255, 255, 255, 0.2);
            user-select: none;
            cursor: move;
            z-index: 1000;
            backdrop-filter: blur(5px);
            color: white;
        }
        
        .controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            margin: 0;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }
        
        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .pin-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            margin-right: 5px;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }
        
        .pin-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .pinned {
            color: #4CAF50;
        }
        
        .greeting {
            color: #22c55e;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .status-message {
            color: #bbf7d0;
            font-size: 16px;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
        }
        
        .container {
            width: 100%;
        }
        
        h2 {
            text-align: center;
            color: #16a34a;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #166534;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.9);
            box-sizing: border-box;
        }
        
        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            box-sizing: border-box;
        }
        
        .btn-success {
            background-color: #16a34a;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #15803d;
        }
        
        #response {
            margin-top: 15px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            max-height: 150px;
            overflow-y: auto;
            color: #bbf7d0;
        }
        
        .hidden {
            display: none;
        }
        
        .show-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #16a34a;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 900;
        }
        
        .show-btn:hover {
            background-color: #15803d;
        }
        
        .crop-status {
            margin-top: 10px;
            width: 100%;
        }
        
        .crop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .crop-name {
            font-weight: bold;
            color: white;
        }
        
        .crop-maturity {
            color: #bbf7d0;
        }
        
        .weather-info {
            margin-top: 10px;
            width: 100%;
        }
        
        .weather-day {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .recommendation {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(22, 101, 52, 0.3);
            border-radius: 4px;
            color: #bbf7d0;
        }
        
        .pulse {
            display: inline-block;
            background-color: #16a34a;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <h1>AgriConnect Digital Twin</h1>
        <div class="status">
            <span style="color: #bbf7d0;">Last updated: Just now</span>
            <div class="pulse">
                <div class="pulse-dot"></div>
            </div>
        </div>
    </header>
     <div class="aura-container" id="auraContainer">
        <div class="controls">
            <button class="pin-btn" id="pinBtn" title="Pin/Unpin">📌</button>
            <button class="close-btn" id="closeBtn" title="Hide">×</button>
        </div>
        <div class="greeting" id="greeting"></div>
        <div class="status-message">
            <span class="pulse"></span>Connected to AgriConnect
        </div>
        <div class="container">
            <h2>KrishiSarthi</h2>
            <div class="form-group">
                <input
                    type="text"
                    class="form-control"
                    id="userInput"
                    placeholder="Ask about crops, weather, markets..." />
            </div>
            <button class="btn btn-success" id="askButton">Ask</button>
            <div id="response">Hello! I'm KrishiSarthi, your agricultural assistant. How can I help you today?</div>
        </div>
    </div>
    
    <button id="showBtn" class="show-btn hidden">Show KrishiSarthi</button>
    
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showTab('dashboard')" id="dashboard-btn">
                📊 Dashboard
            </button>
            <button class="nav-btn" onclick="showTab('maps')" id="maps-btn">
                🗺 Maps
            </button>
            <button class="nav-btn" onclick="showTab('logistics')" id="logistics-btn">
                🚛 Logistics
            </button>
            <button class="nav-btn" onclick="showTab('market')" id="market-btn">
                💰 Market
            </button>
            <button class="nav-btn" onclick="showTab('weather')" id="weather-btn">
                ☁ Weather
            </button>
            <button class="nav-btn" id="weather-btn">
            <a href="advance.html">
              Advance 
            </a>
            </button>
            <button>
                <button class="nav-btn" id="weather-btn"> <a href="soil.html"> Advance</a>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Dashboard Tab -->
        <div id="dashboard-content" class="grid grid-cols-1">

            <!-- AI Recommendations -->
            <div class="card full-width">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <span style="color: #eab308;">⚠</span>
                    <h2>AI Recommendations</h2>
                </div>
                <div class="recommendation-grid">
                    <div class="recommendation-item green-bg">
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Optimal Harvest Date</div>
                        <div style="font-size: 1.25rem; display: flex; align-items: center; gap: 0.25rem;">
                            📅 Tomorrow
                        </div>
                        <div style="font-size: 0.875rem; color: #6b7280;">Window: 2 days</div>
                    </div>
                    <div class="recommendation-item blue-bg">
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Best Market</div>
                        <div style="font-size: 1.25rem; display: flex; align-items: center; gap: 0.25rem;">
                            💰 Market C
                        </div>
                        <div style="font-size: 0.875rem; color: #6b7280;">Est. Profit: $4,250</div>
                    </div>
                    <div class="recommendation-item purple-bg">
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Recommended Transport</div>
                        <div style="font-size: 1.25rem; display: flex; align-items: center; gap: 0.25rem;">
                            🚛 Refrigerated Truck
                        </div>
                        <div style="font-size: 0.875rem; color: #6b7280;">Weather Risk: Low</div>
                    </div>
                </div>
            </div>

            <div class="grid md-grid-cols-3" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                <!-- Crop Status -->
                <div class="card">
                    <h2>Crop Status</h2>
                    <div id="crop-status">
                        <div class="crop-item">
                            <div class="crop-info">
                                <h4>Tomatoes</h4>
                                <div class="crop-location">North Field</div>
                            </div>
                            <div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 95%; background-color: #22c55e;"></div>
                                </div>
                                <div class="progress-text">95% Mature</div>
                            </div>
                        </div>
                        <div class="crop-item">
                            <div class="crop-info">
                                <h4>Potatoes</h4>
                                <div class="crop-location">East Field</div>
                            </div>
                            <div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%; background-color: #eab308;"></div>
                                </div>
                                <div class="progress-text">85% Mature</div>
                            </div>
                        </div>
                        <div class="crop-item">
                            <div class="crop-info">
                                <h4>Corn</h4>
                                <div class="crop-location">West Field</div>
                            </div>
                            <div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 78%; background-color: #f97316;"></div>
                                </div>
                                <div class="progress-text">78% Mature</div>
                            </div>
                        </div>
                        <div class="crop-item">
                            <div class="crop-info">
                                <h4>Lettuce</h4>
                                <div class="crop-location">South Field</div>
                            </div>
                            <div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 92%; background-color: #22c55e;"></div>
                                </div>
                                <div class="progress-text">92% Mature</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weather Preview -->
                <div class="card">
                    <h2>Weather Forecast</h2>
                    <div class="weather-container">
                        <div class="weather-day">
                            <div style="font-weight: 500;">Today</div>
                            <div class="weather-icon" style="background-color: #fbbf24;"></div>
                            <div style="font-weight: bold;">28°C</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">10%</div>
                        </div>
                        <div class="weather-day">
                            <div style="font-weight: 500;">Tomorrow</div>
                            <div class="weather-icon" style="background-color: #fbbf24;"></div>
                            <div style="font-weight: bold;">29°C</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">5%</div>
                        </div>
                        <div class="weather-day">
                            <div style="font-weight: 500;">Saturday</div>
                            <div class="weather-icon" style="background-color: #d1d5db;"></div>
                            <div style="font-weight: bold;">27°C</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">30%</div>
                        </div>
                        <div class="weather-day">
                            <div style="font-weight: 500;">Sunday</div>
                            <div class="weather-icon" style="background-color: #93c5fd;"></div>
                            <div style="font-weight: bold;">24°C</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">70%</div>
                        </div>
                        <div class="weather-day">
                            <div style="font-weight: 500;">Day 5</div>
                            <div class="weather-icon" style="background-color: #d1d5db;"></div>
                            <div style="font-weight: bold;">26°C</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">50%</div>
                        </div>
                    </div>
                </div>

                <!-- Market Price Trends -->
                <div class="card">
                    <h2>Market Price Trends</h2>
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logistics Tab -->
        <div id="logistics-content" class="grid md-grid-cols-2 hidden">
            <!-- Transport Options -->
            <div class="card">
                <h2>Available Transport</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Capacity</th>
                            <th>Cost/km</th>
                            <th>Available</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Small Truck</td>
                            <td>1500 kg</td>
                            <td>$10</td>
                            <td>Tomorrow</td>
                        </tr>
                        <tr>
                            <td>Large Truck</td>
                            <td>4000 kg</td>
                            <td>$18</td>
                            <td>Today</td>
                        </tr>
                        <tr>
                            <td>Refrigerated</td>
                            <td>2500 kg</td>
                            <td>$25</td>
                            <td>Today</td>
                        </tr>
                        <tr>
                            <td>Partner Co-op</td>
                            <td>3500 kg</td>
                            <td>$15</td>
                            <td>Day 3</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Market Comparison -->
            <div class="card">
                <h2>Market Price Comparison</h2>
                <div class="chart-container">
                    <canvas id="marketChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Maps Tab -->
        <div id="maps-content" class="hidden">
            <div class="card placeholder">
                <div class="placeholder-icon">🗺</div>
                <p style="font-size: 1.125rem; margin-bottom: 0.5rem;">Interactive map showing farms, transport routes, and markets</p>
                <p style="font-size: 0.875rem;">(Map visualization would be implemented with geospatial data)</p>
            </div>
        </div>

        <!-- Market Tab -->
        <div id="market-content" class="hidden">
            <div class="card">
                <h2>Market Demand Forecast</h2>
                <div class="chart-container">
                    <canvas id="demandChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Weather Tab -->
        <div id="weather-content" class="grid md-grid-cols-2 hidden">
            <div class="card">
                <h2>5-Day Weather Forecast</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Temperature</th>
                            <th>Precipitation</th>
                            <th>Conditions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Today</td>
                            <td>37°C/27°C</td>
                            <td>0%</td>
                            <td>Sunny </td>
                        </tr>
                        <tr>
                            <td>Tomorrow</td>
                            <td>37°C/28°C</td>
                            <td>15%</td>
                            <td>Partly Cloudy</td>
                        </tr>
                        <tr>
                            <td>Saturday</td>
                            <td>36°C/27°C</td>
                            <td>5%</td>
                            <td>Sunny</td>
                        </tr>
                        <tr>
                            <td>Sunday</td>
                            <td>36°C/28°C</td>
                            <td>5%</td>
                            <td>Rainy</td>
                        </tr>
                        <tr>
                            <td>Monday</td>
                            <td>38°C/29°C</td>
                            <td>50%</td>
                            <td>Partly-cloudy</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>Weather Impact Analysis</h2>
                <div>
                    <div class="impact-item impact-yellow">
                        <h3 class="impact-title">Road Conditions</h3>
                        <p class="impact-text">Heavy rain expected on Day 4 may affect eastern routes</p>
                    </div>
                    <div class="impact-item impact-green">
                        <h3 class="impact-title">Harvest Windows</h3>
                        <p class="impact-text">Optimal conditions for tomato harvest in next 48 hours</p>
                    </div>
                    <div class="impact-item impact-blue">
                        <h3 class="impact-title">Storage Requirements</h3>
                        <p class="impact-text">High temperatures may require refrigerated transport for lettuce</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        AgriConnect Digital Twin Platform | Real-time farm-to-market optimization | By AgriVerse
    </footer>

    <script>
        // Tab functionality
        function showTab(tabName) {
            // Hide all content
            const contents = ['dashboard-content', 'logistics-content', 'maps-content', 'market-content', 'weather-content'];
            contents.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });

            // Remove active class from all buttons
            const buttons = ['dashboard-btn', 'logistics-btn', 'maps-btn', 'market-btn', 'weather-btn'];
            buttons.forEach(id => {
                document.getElementById(id).classList.remove('active');
            });

            // Show selected content and mark button as active
            document.getElementById(tabName + '-content').classList.remove('hidden');
            document.getElementById(tabName + '-btn').classList.add('active');

            // Initialize charts when needed
            if (tabName === 'dashboard') {
                initPriceChart();
            } else if (tabName === 'logistics') {
                initMarketChart();
            } else if (tabName === 'market') {
                initDemandChart();
            }
        }

        // Chart initialization
        let priceChart, marketChart, demandChart;

        function initPriceChart() {
            const ctx = document.getElementById('priceChart');
            if (!ctx || priceChart) return;

            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                    datasets: [
                        {
                            label: 'Tomatoes',
                            data: [38, 42, 45, 40, 35],
                            borderColor: '#FF6B6B',
                            backgroundColor: '#FF6B6B',
                            tension: 0.4
                        },
                        {
                            label: 'Potatoes',
                            data: [22, 24, 25, 26, 28],
                            borderColor: '#4ECDC4',
                            backgroundColor: '#4ECDC4',
                            tension: 0.4
                        },
                        {
                            label: 'Corn',
                            data: [18, 19, 18, 17, 16],
                            borderColor: '#FFE66D',
                            backgroundColor: '#FFE66D',
                            tension: 0.4
                        },
                        {
                            label: 'Lettuce',
                            data: [45, 48, 52, 55, 50],
                            borderColor: '#1A535C',
                            backgroundColor: '#1A535C',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Price ($/kg)'
                            }
                        }
                    }
                }
            });
        }

        function initMarketChart() {
            const ctx = document.getElementById('marketChart');
            if (!ctx || marketChart) return;

            marketChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Market A', 'Market B', 'Market C', 'Market D'],
                    datasets: [
                        {
                            label: 'Price ($/kg)',
                            data: [42, 38, 45, 36],
                            backgroundColor: '#4ECDC4'
                        },
                        {
                            label: 'Distance (km)',
                            data: [15, 8, 22, 12],
                            backgroundColor: '#FF6B6B'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function initDemandChart() {
            const ctx = document.getElementById('demandChart');
            if (!ctx || demandChart) return;

            demandChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                    datasets: [
                        {
                            label: 'Tomatoes',
                            data: [38, 42, 45, 40, 35],
                            borderColor: '#FF6B6B',
                            backgroundColor: '#FF6B6B',
                            tension: 0.4
                        },
                        {
                            label: 'Potatoes',
                            data: [22, 24, 25, 26, 28],
                            borderColor: '#4ECDC4',
                            backgroundColor: '#4ECDC4',
                            tension: 0.4
                        },
                        {
                            label: 'Corn',
                            data: [18, 19, 18, 17, 16],
                            borderColor: '#FFE66D',
                            backgroundColor: '#FFE66D',
                            tension: 0.4
                        },
                        {
                            label: 'Lettuce',
                            data: [45, 48, 52, 55, 50],
                            borderColor: '#1A535C',
                            backgroundColor: '#1A535C',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Demand Index'
                            }
                        }
                    }
                }
            });
        }

        // Initialize dashboard chart on load
        document.addEventListener('DOMContentLoaded', function() {
            initPriceChart();
        });
         document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const auraContainer = document.getElementById('auraContainer');
            const greetingEl = document.getElementById('greeting');
            const closeBtn = document.getElementById('closeBtn');
            const pinBtn = document.getElementById('pinBtn');
            const showBtn = document.getElementById('showBtn');
            const askButton = document.getElementById('askButton');
            const userInput = document.getElementById('userInput');
            const responseDiv = document.getElementById('response');
            
            // Variables
            let isPinned = localStorage.getItem('krishiSarthiPinned') === 'true';
            
            // Set initial greeting
            updateGreeting();
            
            // Pin status
            if (isPinned) {
                pinBtn.classList.add('pinned');
            }
            
            // Close button
            closeBtn.addEventListener('click', function() {
                auraContainer.style.display = 'none';
                showBtn.classList.remove('hidden');
            });
            
            // Show button
            showBtn.addEventListener('click', function() {
                auraContainer.style.display = 'flex';
                showBtn.classList.add('hidden');
            });
            
            // Pin/Unpin
            pinBtn.addEventListener('click', function() {
                isPinned = !isPinned;
                localStorage.setItem('krishiSarthiPinned', isPinned);
                
                if (isPinned) {
                    pinBtn.classList.add('pinned');
                } else {
                    pinBtn.classList.remove('pinned');
                }
            });
            
            // Make the container draggable
            let isDragging = false;
            let offsetX, offsetY;
            
            auraContainer.addEventListener('mousedown', function(e) {
                // Ignore if clicked on buttons or input
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
                
                isDragging = true;
                offsetX = e.clientX - auraContainer.getBoundingClientRect().left;
                offsetY = e.clientY - auraContainer.getBoundingClientRect().top;
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const x = e.clientX - offsetX;
                const y = e.clientY - offsetY;
                
                // Keep within window bounds
                const maxX = window.innerWidth - auraContainer.offsetWidth;
                const maxY = window.innerHeight - auraContainer.offsetHeight;
                
                auraContainer.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
                auraContainer.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
            });
            
            document.addEventListener('mouseup', function() {
                isDragging = false;
            });
            
            // Functions
            function updateGreeting() {
                const hour = new Date().getHours();
                let greeting;
                
                if (hour < 12) {
                    greeting = "Good morning, farmer 🌞";
                } else if (hour < 18) {
                    greeting = "Good afternoon, farmer ☀";
                } else {
                    greeting = "Good evening, farmer 🌙";
                }
                
                greetingEl.textContent = greeting;
            }
            
            // Handle AI assistant responses
            function processResponse(data) {
                let responseHTML = '';
                
                if (data.type === 'crops') {
                    responseHTML = `<p>${data.message}</p><div class="crop-status">`;
                    for (const [crop, info] of Object.entries(data.data)) {
                        responseHTML += `
                            <div class="crop-item">
                                <span class="crop-name">${crop}</span>
                                <span class="crop-maturity">${info.maturity}% mature</span>
                            </div>
                        `;
                    }
                    responseHTML += '</div>';
                } 
                else if (data.type === 'weather') {
                    responseHTML = `<p>${data.message}</p><div class="weather-info">`;
                    for (const day of data.data) {
                        responseHTML += `
                            <div class="weather-day">
                                <span>${day.day}</span>
                                <span>${day.temp}°C, ${day.conditions}</span>
                            </div>
                        `;
                    }
                    responseHTML += '</div>';
                } 
                else if (data.type === 'markets') {
                    responseHTML = `<p>${data.message}</p><div class="weather-info">`;
                    for (const market of data.data) {
                        responseHTML += `
                            <div class="weather-day">
                                <span>${market.name}</span>
                                <span>$${market.price}/kg (${market.distance} km)</span>
                            </div>
                        `;
                    }
                    responseHTML += '</div>';
                } 
                else if (data.type === 'transport') {
                    responseHTML = `<p>${data.message}</p><div class="weather-info">`;
                    for (const option of data.data) {
                        responseHTML += `
                            <div class="weather-day">
                                <span>${option.type}</span>
                                <span>${option.capacity}kg, $${option.cost_per_km}/km</span>
                            </div>
                        `;
                    }
                    responseHTML += '</div>';
                } 
                else if (data.type === 'recommendations') {
                    const rec = data.data;
                    responseHTML = `
                        <p>${data.message}</p>
                        <div class="recommendation">
                            <strong>Harvest:</strong> ${rec.harvest.crop} (${rec.harvest.date})<br>
                            <strong>Market:</strong> ${rec.market.name} ($${rec.market.estimated_profit} est. profit)<br>
                            <strong>Transport:</strong> ${rec.transport.type} (Weather risk: ${rec.transport.weather_risk})
                        </div>
                    `;
                } 
                else {
                    responseHTML = `<p>${data.message}</p>`;
                }
                
                return responseHTML;
            }
            
            // Send message to backend
            async function sendMessage() {
                const input = userInput.value.trim();
                if (!input) {
                    responseDiv.innerHTML = 'Please enter a question.';
                    return;
                }
                
                // Disable button during processing
                askButton.disabled = true;
                askButton.textContent = 'Processing...';
                responseDiv.innerHTML = 'Analyzing your query...';
                
                try {
                    // Simulate API call - In real implementation, replace with actual backend call
                    // Example: const response = await fetch('/api/query', {...})
                    
                    // For demo, we'll simulate responses based on keywords
                    let data;
                    
                    if (input.toLowerCase().includes('crop') || input.toLowerCase().includes('harvest')) {
                        data = {
                            type: 'crops',
                            data: {
                                "Tomatoes": {"maturity": 95, "location": "North Field"},
                                "Potatoes": {"maturity": 85, "location": "East Field"},
                                "Corn": {"maturity": 78, "location": "West Field"},
                                "Lettuce": {"maturity": 92, "location": "South Field"}
                            },
                            message: "Here's the current status of your crops:"
                        };
                    } else if (input.toLowerCase().includes('weather') || input.toLowerCase().includes('rain')) {
                        data = {
                            type: 'weather',
                            data: [
                                {"day": "Today", "temp": 28, "precipitation": 10, "conditions": "Sunny"},
                                {"day": "Tomorrow", "temp": 29, "precipitation": 5, "conditions": "Sunny"},
                                {"day": "Day 3", "temp": 27, "precipitation": 30, "conditions": "Partly-cloudy"},
                                {"day": "Day 4", "temp": 24, "precipitation": 70, "conditions": "Rainy"},
                                {"day": "Day 5", "temp": 26, "precipitation": 50, "conditions": "Partly-cloudy"}
                            ],
                            message: "Here's the current weather forecast for your farm area:"
                        };
                    } else if (input.toLowerCase().includes('market') || input.toLowerCase().includes('price')) {
                        data = {
                            type: 'markets',
                            data: [
                                {"name": "Market A", "price": 42, "distance": 15},
                                {"name": "Market B", "price": 38, "distance": 8},
                                {"name": "Market C", "price": 45, "distance": 22},
                                {"name": "Market D", "price": 36, "distance": 12}
                            ],
                            message: "Here's the current market information:"
                        };
                    } else if (input.toLowerCase().includes('transport') || input.toLowerCase().includes('truck')) {
                        data = {
                            type: 'transport',
                            data: [
                                {"type": "Small Truck", "capacity": 1500, "cost_per_km": 10, "available": "Tomorrow"},
                                {"type": "Large Truck", "capacity": 4000, "cost_per_km": 18, "available": "Today"},
                                {"type": "Refrigerated", "capacity": 2500, "cost_per_km": 25, "available": "Today"},
                                {"type": "Partner Co-op", "capacity": 3500, "cost_per_km": 15, "available": "Day 3"}
                            ],
                            message: "Here's the available transport options:"
                        };
                    } else if (input.toLowerCase().includes('recommend') || input.toLowerCase().includes('advise')) {
                        data = {
                            type: 'recommendations',
                            data: {
                                "harvest": {
                                    "crop": "Tomatoes",
                                    "date": "Tomorrow",
                                    "window": "2 days"
                                },
                                "market": {
                                    "name": "Market C",
                                    "estimated_profit": 4250
                                },
                                "transport": {
                                    "type": "Refrigerated Truck",
                                    "weather_risk": "Low"
                                }
                            },
                            message: "Based on current conditions, here are my recommendations:"
                        };
                    } else {
                        data = {
                            type: 'general',
                            message: "I can help with information about your crops, weather forecasts, market prices, and transport options. I can also provide personalized recommendations. What would you like to know about?"
                        };
                    }
                    
                    responseDiv.innerHTML = processResponse(data);
                } catch (error) {
                    console.error("Error:", error);
                    responseDiv.innerHTML = 'Sorry, I encountered an error processing your request.';
                } finally {
                    // Re-enable button
                    askButton.disabled = false;
                    askButton.textContent = 'Ask';
                    userInput.value = '';
                }
            }
            
            // Add click event for Ask button
            askButton.addEventListener('click', sendMessage);
            
            // Add Enter key support
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Update greeting every minute
            setInterval(updateGreeting, 60000);
        });
    </script>
</body>
</html>
